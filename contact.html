<!DOCTYPE html>
<html lang="fr">
<head><meta charset="UTF-8" /><title>Fiche contact</title></head>
<body>
<h1>Fiche contact NFC</h1>
<button id="downloadBtn">Télécharger la fiche contact</button>
<script>
  function base64Decode(str) {
    return decodeURIComponent(escape(atob(str)));
  }

  const params = new URLSearchParams(window.location.search);
  const data = params.get('data');
  const btn = document.getElementById('downloadBtn');

  if(!data) {
    btn.textContent = 'Données manquantes';
    btn.disabled = true;
  } else {
    let contact;
    try {
      contact = JSON.parse(base64Decode(data));
    } catch(e) {
      btn.textContent = 'Données invalides';
      btn.disabled = true;
    }

    if(contact) {
      const vcard = `BEGIN:VCARD
VERSION:3.0
FN:${contact.name}
TEL;TYPE=CELL:${contact.phone}
EMAIL;TYPE=INTERNET:${contact.email}
END:VCARD`;

      btn.addEventListener('click', () => {
        const blob = new Blob([vcard], {type: 'text/vcard'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = contact.name.replace(/\s+/g, '_') + '.vcf';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
    }
  }
</script>
</body>
</html>

</body>
</html>


